.modal-dialog
  .modal-content
    .modal-header
      %button.close{"aria-hidden" => "true", "data-dismiss" => "modal", :type => "button"} Ã—
      %h4
        ="Add Students"
    = form_tag "/sharings",:class => "form-horizontal", :id => "choose_students", remote: true do |f|
      .modal-body
        .row    
          .col-xs-12
            .alert.alert-warning.fade.in
              Either enter comma separated emails of students or choose from group   
          .col-xs-12
            .alert.alert-success.fade.in
              None Users will be sent emails, which will take time      
        .row
          .col-xs-12.emails-div      
            =text_field_tag :email_ids, nil, class: "form-control emails", placeholder: "Enter comma separated emails"
          .col-xs-12.email-show-btn-div.hide
            %button.btn.btn-primary.btn-warning.email-show-btn{style: "width:100%"} Serve Individuals 
        .row{style: "margin-top:10px;"}
          .col-xs-6
            =select_tag 'quiz_bank_id', options_for_select(current_user.quiz_banks.collect{ |u| [u.title, u.id] }), :class => "form-control", prompt: "Select Quiz"
          .col-xs-6.hide.group-dropdown
            -if current_user.groups.blank?
              = "No student group"
            -else
              =select_tag 'group_id', options_for_select(current_user.groups.collect{ |u| [u.title, u.id] }), :class => "form-control student-group-id", prompt: "Select Group"
          .col-xs-6.select-from-group
            %button.btn.btn-primary.btn-warning.select-from-group-btn{style: "width:100%"} Select from Group    
        .row.students
          .student-cloud.col-xs-12{style: "margin-top:10px;"}
          .col-xs-12.emails-for-group-div.hide
            =text_field_tag :emails_for_group_ids, nil, class: "form-control emails-for-group", placeholder: "Enter comma separated emails"          
      .modal-footer
        =submit_tag "Serve Quiz",{class:"btn btn-primary",placeholder: "Enter comma separated emails to add students"}


:javascript
  $(document).ready(function(){
    $(".modal-body").on("change", ".student-group-id", function(){
      if($(this).val() != ""){
        $(".emails-for-group-div").removeClass("hide")
        value = $(this).val()
        $.ajax({
          url: "/groups/"+value+"/get_student",
          method: "get",
          success: function(data){
            $(".student-cloud").html($(data).find('.student-cloud').html())
          }
        })
      }
      else{
        $(".student-cloud").html("")
        $(".emails-for-group-div").addClass("hide")
      }
    })
    $(".modal-body").on("click", ".select-from-group-btn", function(e){
      e.preventDefault()
      $(".group-dropdown").removeClass("hide")
      $(".select-from-group").addClass("hide")
      $(".emails-div").addClass("hide")
      $(".email-show-btn-div").removeClass("hide")
      $(".student-group-id").val("")
    })
    $(".modal-body").on("click", ".email-show-btn", function(e){
      e.preventDefault()
      $(".group-dropdown").addClass("hide")
      $(".select-from-group").removeClass("hide")
      $(".emails-div").removeClass("hide")
      $(".email-show-btn-div").addClass("hide")
      $(".student-cloud").html("")
      $(".emails-for-group-div").addClass("hide")
    })

    $(".modal-body").on("keydown", ".emails-for-group", function(key){
      if(key.keyCode == 13){
        key.preventDefault()
        value = $(this).val()
        $.ajax({
          url: "sharings/add_students",
          method: "GET",
          data: {emails: value},
          success: function(data){
            console.log(data)
            $(".student-thumbnails").append($(data).find('.invited-users').html())
          }
        })
      }
    })
  })
      
