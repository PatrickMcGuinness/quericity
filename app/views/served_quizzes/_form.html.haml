.modal-dialog
  .modal-content
    .modal-header
      %button.close{"aria-hidden" => "true", "data-dismiss" => "modal", :type => "button"} Ã—
      %h4
        ="Serve Quiz"
    = form_for @served_quiz,:class => "form-horizontal", :id => "choose_students", remote: true do |f|  
      .modal-body
        #wizard
          %h1 Quiz
          %div
            %legend Select Quiz
            .row
              .col-xs-12{style: "margin-bottom:10px;"}
                = f.select :quiz_bank_id, current_user.quiz_banks.map{|q| [q.title,q.id]},{prompt: "Select Quiz"},{class: 'form-control'}      
       
          %h1 Students
          %div
            %legend Select Students
            .row 
              .col-xs-12.emails-div     
                =text_field_tag :email_ids, nil, class: "form-control emails", placeholder: "Enter comma separated emails then press enter"
              .col-xs-2.add-users.pull-right{style: "margin-top:10px;"}
                =link_to "Add more students", "#", class: "add-more-students btn btn-primary btn-warning" 
              .col-xs-12.hide.group-dropdown
                -if current_user.groups_to_show.blank?
                  = "No student group"
                -else
                  =select_tag 'group_id', options_for_select(current_user.groups_to_show.collect{ |u| [u.title, u.id] }), :class => "form-control student-group-id", prompt: "Select Group"
            .row{style: "margin-top:10px;"}
              .col-xs-6
                =link_to "OR Select from group", "#", class: "select-from-group"
                =link_to "OR Enter email ids", "#", class: "select-from-email hide"
            .row.students-email
              .student-cloud.col-xs-12{style: "margin-top:10px;"}
                .student-thumbnails{style:"margin-top:10px;"}  
                  -current_user.students.each do |student|
                    .col-xs-2{style: "margin-left:5px;"}
                      .thumbnail.row{style:"width:220px"}
                        .col-xs-1
                          =check_box_tag "student_ids[]" ,student.id,false,:class => "delete"
                        .col-xs-1
                          %img{src:"/assets/Picupload_bg.png", id:"student-image",style:"width:25px;height:25px;"}
                        .col-xs-6.offset-1{style:"font-size:10px;"}
                          -if student.name.blank?
                            = "Name not set by student"
                          -else
                            = student.name
                          =student.email

              .col-xs-12.emails-for-group-div.hide
                =text_field_tag :emails_for_group_ids, nil, class: "form-control emails-for-group", placeholder: "Enter comma separated emails then press enter"
              .col-xs-2.add-user-group-div.pull-right.hide{style: "margin-top:10px;"}
                =link_to "Add more students", "#", class: "btn btn-primary btn-warning add-user-group"          
          %h1 Options
          %div
            %legend Choose Options
            .row
              .col-xs-4
                .input-group.date#datetimepicker1
                  =f.text_field :date,:placeholder => "Start date",class: "form-control"
                  %span.input-group-addon
                    %span.glyphicon.glyphicon-calendar
              .col-xs-4
                .input-group.date#datetimepicker2
                  =f.text_field :start_time,:placeholder => "Start time",class: 'form-control'
                  %span.input-group-addon
                    %span.glyphicon.glyphicon-time  
              .col-xs-4
                =f.select :duration,[["10 min",10],["20 mins", 20]], {},{class: "form-control"}
              .col-xs-12.mar-top-20
                = f.text_area :instructions,rows:10,:placeholder => "Add instructions", class: "form-control"      
              .col-xs-8.mar-top-20
                ="Show the answers to students after the quiz: "
              .col-xs-4.mar-top-20  
                =f.check_box :answer
              .col-xs-8.mar-top-20
                ="Randomize the questions on serve: "
              .col-xs-4.mar-top-20  
                =f.check_box :random         

:javascript
  $(document).ready(function(){
    $("#wizard").steps({
      onStepChanging: function (event, currentIndex, newIndex){
        check = 0; 
        if(currentIndex == 0){
          if ($("#served_quiz_quiz_bank_id").val() == ""){
            $("#served_quiz_quiz_bank_id").siblings("label.error").remove()
            $("#served_quiz_quiz_bank_id").after("<label class = 'error'>Select a quiz<label>")
            check = 1;
          }
          else{
            $("#served_quiz_quiz_bank_id").siblings("label.error").remove()
            check = 0
          }
        }
        if(currentIndex == 1){
          if($(".delete").is(":checked")){
            check = 0
            $(".student-cloud").siblings("label.error").remove()
          }
          else{
            check = 1
            $(".student-cloud").siblings("label.error").remove()
            $(".student-cloud").before("<label class = 'error'>Select at least one student<label>")
          }
        }
        if(check == 0){
          return true;
        }
        if(check == 1){
          return false
        } 
      },
      onFinishing: function (event, currentIndex){ 
        $("form#new_served_quiz").submit() 
      },
      labels: { finish: "Serve Quiz"}
    });
    $(".date-picker").datepicker();
    $(".modal-body").on("click", ".add-more-students", function(e){
      e.preventDefault()
      console.log("hello")
      $.ajax({
        url: "/served_quizzes/add_more_students",
        method: "GET",
        data: {emails:$(".emails").val(), quiz_bank_id: $("#quiz-bank-id").val()},
        success: function(data){
          $(".student-thumbnails").append($(data).find('.student-thumbnails').html())
          $(".emails").val("")
        }
      })
    })
    $(".modal-body").on("change", ".student-group-id", function(){
      if($(this).val() != ""){
        $(".emails-for-group-div").removeClass("hide")
        $(".add-user-group-div").removeClass("hide")
        value = $(this).val()
        $.ajax({
          url: "/groups/"+value+"/get_student",
          method: "get",
          success: function(data){
            $(".student-cloud").html($(data).find('.student-cloud').html())
          }
        })
      }
      else{
        $(".student-cloud").html("")
        $(".emails-for-group-div").addClass("hide")
      }
    })
    $(".modal-body").on("click", ".select-from-group", function(e){
      e.preventDefault()
      $(".group-dropdown").removeClass("hide")
      $(".emails-div").addClass("hide")
      $(".student-thumbnails").html("")
      $(this).addClass("hide")
      $(".add-users").addClass("hide")
      $(".select-from-email").removeClass("hide")
    })
    $(".modal-body").on("click", ".select-from-email", function(e){
      e.preventDefault()
      $(".group-dropdown").addClass("hide")
      $(".emails-div").removeClass("hide")
      $(".student-thumbnails").html("")
      $(this).addClass("hide")
      $(".select-from-group").removeClass("hide")
      $(".emails-for-group-div").addClass("hide")
      $(".add-users").removeClass("hide")
      $(".add-user-group-div").addClass("hide")
      $.ajax({
        url: "/served_quizzes/get_all_students",
        method: "GET",
        success: function(data){
          $(".student-thumbnails").html($(data).find('.student-thumbnails').html())
        }
      })
    })

    $(".modal-body").on("click", ".add-user-group", function(e){
      e.preventDefault()
      console.log("hello")
      $.ajax({
        url: "/served_quizzes/add_more_students",
        method: "GET",
        data: {emails:$(".emails-for-group").val(), quiz_bank_id: $("#quiz-bank-id").val()},
        success: function(data){
          console.log(data)
          $(".student-thumbnails").append($(data).find('.student-thumbnails').html())
          $(".emails-for-group").val("")
        }
      })
    })
  })
      
